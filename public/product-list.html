<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="icon" type="image/png" href="assets/logo/AGOS-FAVICON.svg" />
    <title>Agos Coffee - Product List</title>
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/mediaquery.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
  </head>
  <body>
    <header class="site-header">
      <div class="header-left">
        <button
          id="hamburger-toggle"
          class="hamburger-btn"
          aria-label="Open menu"
          aria-expanded="false"
          aria-controls="sidebar-menu"
        >
          <span class="hamburger-line"></span>
          <span class="hamburger-line"></span>
          <span class="hamburger-line"></span>
        </button>
        <a href="product-list.html" class="order-btn">Order Now</a>
      </div>
      <div class="header-center">
        <nav class="main-nav left-nav">
          <ul class="nav-list">
            <li><a href="index.html">Home</a></li>
            <li><a href="product-list.html">Products</a></li>
          </ul>
        </nav>
        <a href="index.html" class="logo-link">
          <img
            src="assets/logo/AGOS-LOGO.svg"
            alt="Agos Coffee logo"
            class="logo"
          />
        </a>
        <nav class="main-nav right-nav">
          <ul class="nav-list">
            <li><a href="feature.html">Feature</a></li>
            <li><a href="contact.html">Contact Us</a></li>
          </ul>
        </nav>
      </div>
      <div class="header-right">
        <a
          href="product-list.html#cartPanel"
          class="cart-btn"
          aria-label="Open cart"
        >
          <img src="assets/icons/CART-QTY.svg" alt="Cart" class="cart-img" />
          <span id="cart-count" class="cart-count">0</span>
        </a>
      </div>
    </header>

    <aside id="sidebar-menu" class="sidebar-menu" aria-hidden="true">
      <div class="sidebar-header">
        <a href="index.html" class="logo-link sidebar-logo-link">
          <img
            src="assets/logo/AGOS-LOGO.svg"
            alt="Agos Coffee logo"
            class="logo sidebar-logo"
          />
        </a>
      </div>
      <nav class="sidebar-nav">
        <ul class="nav-list sidebar-nav-list">
          <li><a href="index.html">Home</a></li>
          <li><a href="product-list.html">Products</a></li>
          <li><a href="feature.html">Feature</a></li>
          <li><a href="contact.html">Contact Us</a></li>
          <li>
            <a
              href="product-list.html"
              class="order-btn-mobile sidebar-order-btn"
              >Order Now</a
            >
          </li>
        </ul>
      </nav>
    </aside>
    <div id="sidebar-overlay" class="sidebar-overlay" aria-hidden="true"></div>

    <main class="container">
      <section class="content-left">
        <div class="products-header">
          <div class="filters">
            <a class="filter-btn" href="#popular" data-category="Popular"
              >Popular</a
            >
            <a class="filter-btn" href="#specialty" data-category="Specialty"
              >Specialty</a
            >
            <a class="filter-btn" href="#coffee" data-category="Coffee"
              >Coffee</a
            >
            <a class="filter-btn" href="#non-coffee" data-category="Non-Coffee"
              >Non-Coffee</a
            >
            <a class="filter-btn" href="#matcha" data-category="Matcha"
              >Matcha</a
            >
          </div>

          <div class="search-wrap">
            <input
              type="search"
              id="search"
              placeholder="Search products..."
              aria-label="Search products"
            />
            <img
              src="assets/icons/search-icon-black.svg"
              alt="search"
              class="search-img"
            />
          </div>
        </div>

        <div
          id="searchResults"
          class="product-grid"
          style="display: none"
        ></div>
        <div id="noResults" class="no-results"></div>

        <section id="popular" class="product-section">
          <h2 class="section-title">Popular</h2>
          <div class="product-grid" id="popularGrid"></div>
        </section>

        <section id="specialty" class="product-section">
          <h2 class="section-title">Specialty</h2>
          <div class="product-grid" id="specialtyGrid"></div>
        </section>

        <section id="coffee" class="product-section">
          <h2 class="section-title">Coffee</h2>
          <div class="product-grid" id="coffeeGrid"></div>
        </section>

        <section id="non-coffee" class="product-section">
          <h2 class="section-title">Non-Coffee</h2>
          <div class="product-grid" id="nonCoffeeGrid"></div>
        </section>

        <section id="matcha" class="product-section">
          <h2 class="section-title">Matcha</h2>
          <div class="product-grid" id="matchaGrid"></div>
        </section>
      </section>

      <aside class="cart-panel" id="cartPanel" aria-live="polite">
        <div class="cart-header">
          <h3>Your cart</h3>
          <small class="cart-mode">Pick-up</small>
        </div>
        <div id="cartBody" class="cart-body">
          <div class="empty-illustration">
            <img
              src="assets/icons/CART-PANEL.svg"
              alt="Empty Cart"
              class="empty-cart-img"
            />
            <h4>Hungry?</h4>
            <p>You haven't added anything to your cart!</p>
          </div>
        </div>
        <div id="cartFooter" class="cart-footer">
          <div class="cart-total-row">
            <span>Total</span>
            <span id="cartTotal">â‚±0</span>
          </div>
          <button id="checkoutBtn" class="checkout-btn" disabled>
            Checkout
          </button>
        </div>
      </aside>
    </main>

    <div id="checkoutModal" class="modal">
      <div class="modal-content">
        <h3>Confirm Order</h3>
        <p>Are you sure you want to checkout?</p>
        <div class="modal-actions">
          <button id="cancelCheckout" class="btn cancel-btn">Cancel</button>
          <button id="confirmCheckout" class="btn confirm-btn">Confirm</button>
        </div>
      </div>
    </div>

    <footer class="footer">
      <div class="footer-container">
        <!-- LEFT SIDE LINKS -->
        <div class="footer-links">
          <div class="footer-column">
            <h4>Order Online</h4>
            <ul>
              <li><a href="product-list.html#specialty">Specialty</a></li>
              <li><a href="product-list.html#coffee">Coffee</a></li>
              <li><a href="product-list.html#non-coffee">Non-Coffee</a></li>
              <li><a href="product-list.html#matcha">Matcha</a></li>
            </ul>
          </div>
          <div class="footer-column">
            <h4>Feature</h4>
            <ul>
              <li>
                <a href="index.html#customer-favorites">Customer Favorites</a>
              </li>
              <li><a href="feature.html#new-product">New Product</a></li>
              <li><a href="feature.html#featured-items">Featured Items</a></li>
            </ul>
          </div>
          <div class="footer-column">
            <h4>Support</h4>
            <ul>
              <li><a href="index.html#faq">FAQs</a></li>
              <li><a href="contact.html">Contact Us</a></li>
              <li><a href="#">Phone: 0947-191-8437</a></li>
              <li><a href="#">Mon-Sun: 10 AM - 11 PM</a></li>
            </ul>
          </div>
          <div class="footer-column">
            <h4>Get to Know Us</h4>
            <ul>
              <li><a href="index.html#about">About Us</a></li>
              <li><a href="index.html#testimonials">Testimonials</a></li>
              <li><a href="index.html#brew-guides">Brew Guides</a></li>
            </ul>
          </div>
        </div>

        <div class="footer-newsletter">
          <h4>Sign up for email updates</h4>
          <form class="newsletter-form">
            <input type="email" placeholder="Your Email" required />
            <button type="submit">Submit</button>
          </form>
          <div class="footer-socials">
            <a
              href="https://www.facebook.com/profile.php?id=61550342585463"
              target="_blank"
              ><i class="fab fa-facebook-f"></i
            ></a>
            <a href="https://www.instagram.com/agoscoffee____/" target="_blank"
              ><i class="fab fa-instagram"></i
            ></a>
            <a href="https://www.tiktok.com/@agos.coffee" target="_blank"
              ><i class="fab fa-tiktok"></i
            ></a>
          </div>
        </div>
      </div>

      <div id="newsletterModal" class="modal">
        <div class="modal-content">
          <h3>Thank You!</h3>
          <p>You've successfully signed up for our newsletter.</p>
          <div class="modal-actions">
            <button class="btn cancel-btn" id="closeNewsletter">Close</button>
          </div>
        </div>
      </div>

      <div class="footer-bottom">
        <p>&copy; 2025 Agos Coffee. All Rights Reserved.</p>
      </div>
    </footer>

    <script src="js/hamburger-menu.js"></script>
    <script src="js/main.js" defer></script>
    <script src="js/newsletter-and-cart.js" defer></script>
    <script src="js/cart.js" defer></script>
    <script src="js/checkout.js" defer></script>
    <script src="js/search.js" defer></script>
    <script src="js/events.js" defer></script>

    <script>
      // Fetch products from API and render dynamically
      async function fetchProducts() {
        try {
          const res = await fetch("/api/products");
          const products = await res.json();
          const sections = {
            Popular: document.getElementById("popularGrid"),
            Specialty: document.getElementById("specialtyGrid"),
            Coffee: document.getElementById("coffeeGrid"),
            "Non-Coffee": document.getElementById("nonCoffeeGrid"),
            Matcha: document.getElementById("matchaGrid"),
          };

          products.forEach((product) => {
            const card = document.createElement("article");
            card.classList.add("product-card");
            card.dataset.name = product.name;
            card.dataset.price = product.price;
            card.dataset.category = product.category;
            card.dataset.img = product.img;

            card.innerHTML = `
              <div class="product-info">
                <h3 class="product-title">${product.name}</h3>
                <p class="product-desc">${product.desc}</p>
                <div class="product-price">â‚±${product.price}</div>
              </div>
              <div class="product-media">
                <img src="${product.img}" alt="${product.name}" />
                <button class="add-btn" aria-label="Add ${product.name} to cart">+</button>
              </div>
            `;

            if (sections[product.category]) {
              sections[product.category].appendChild(card);
            }
          });
        } catch (err) {
          console.error("Error fetching products:", err);
        }
      }

      fetchProducts();

      // Search functionality
      const searchInput = document.getElementById("search");
      const searchResults = document.getElementById("searchResults");
      const noResults = document.getElementById("noResults");

      searchInput.addEventListener("input", async () => {
        const query = searchInput.value.toLowerCase();
        if (!query) {
          searchResults.style.display = "none";
          noResults.textContent = "";
          return;
        }

        try {
          const res = await fetch(
            `http://localhost:3000/api/products?search=${query}`
          );
          const results = await res.json();

          searchResults.innerHTML = "";
          if (results.length === 0) {
            noResults.textContent = "No products found.";
            searchResults.style.display = "none";
          } else {
            noResults.textContent = "";
            searchResults.style.display = "grid";
            const seen = new Set();

            results.forEach((product) => {
              if (seen.has(product.name)) return; // skip duplicates
              seen.add(product.name);

              const card = document.createElement("article");
              card.classList.add("product-card");
              card.dataset.name = product.name;
              card.dataset.price = product.price;
              card.dataset.category = product.category;
              card.dataset.img = product.img;

              card.innerHTML = `
    <div class="product-info">
      <h3 class="product-title">${product.name}</h3>
      <p class="product-desc">${product.desc}</p>
      <div class="product-price">â‚±${product.price}</div>
    </div>
    <div class="product-media">
      <img src="${product.img}" alt="${product.name}" />
      <button class="add-btn" aria-label="Add ${product.name} to cart">+</button>
    </div>
  `;

              searchResults.appendChild(card);
            });
          }
        } catch (err) {
          console.error("Error searching products:", err);
        }
      });
    </script>
  </body>
</html>
