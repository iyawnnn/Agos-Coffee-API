<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Customer Messages - Agos Coffee</title>
    <link rel="icon" type="image/png" href="assets/logo/AGOS-FAVICON.svg" />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/mediaquery.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
  </head>
  <body class="customer-page">
    <!-- HEADER / NAVBAR -->
    <header class="site-header">
      <div class="header-left">
        <button
          id="hamburger-toggle"
          class="hamburger-btn"
          aria-label="Open menu"
          aria-expanded="false"
          aria-controls="sidebar-menu"
        >
          <span class="hamburger-line"></span>
          <span class="hamburger-line"></span>
          <span class="hamburger-line"></span>
        </button>
        <a href="product-list.html" class="order-btn">Order Now</a>
      </div>

      <div class="header-center">
        <nav class="main-nav left-nav">
          <ul class="nav-list">
            <li><a href="index.html">Home</a></li>
            <li><a href="product-list.html">Products</a></li>
            <li><a href="feature.html">Feature</a></li>
          </ul>
        </nav>

        <a href="index.html" class="logo-link">
          <img
            src="assets/logo/AGOS-LOGO.svg"
            alt="Agos Coffee logo"
            class="logo"
          />
        </a>

        <nav class="main-nav right-nav">
          <ul class="nav-list">
            <li><a href="customer-list.html" class="active">Customers</a></li>
            <li><a href="messages.html">Messages</a></li>
            <li><a href="contact.html">Contact Us</a></li>
          </ul>
        </nav>
      </div>

      <div class="header-right">
        <a
          href="product-list.html#cartPanel"
          class="cart-btn"
          aria-label="Open cart"
        >
          <img src="assets/icons/CART-QTY.svg" alt="Cart" class="cart-img" />
          <span id="cart-count" class="cart-count">0</span>
        </a>
      </div>
    </header>

    <!-- SIDEBAR MENU (mobile) -->
    <aside id="sidebar-menu" class="sidebar-menu" aria-hidden="true">
      <div class="sidebar-header">
        <a href="index.html" class="logo-link sidebar-logo-link">
          <img
            src="assets/logo/AGOS-LOGO.svg"
            alt="Agos Coffee logo"
            class="logo sidebar-logo"
          />
        </a>
      </div>
      <nav class="sidebar-nav">
        <ul class="nav-list sidebar-nav-list">
          <li><a href="index.html">Home</a></li>
          <li><a href="product-list.html">Products</a></li>
          <li><a href="feature.html">Feature</a></li>
          <li><a href="contact.html">Contact Us</a></li>
          <li><a href="customer-list.html" class="active">Customers</a></li>
          <li><a href="messages.html">Messages</a></li>
          <li>
            <a
              href="product-list.html"
              class="order-btn-mobile sidebar-order-btn"
              >Order Now</a
            >
          </li>
        </ul>
      </nav>
    </aside>

    <div id="sidebar-overlay" class="sidebar-overlay" aria-hidden="true"></div>

    <!-- MAIN CONTENT -->
    <main class="messages-container">
      <div class="messages-header">
        <h2 class="messages-title">Customer Messages</h2>
        <div class="messages-search-wrapper">
          <i class="fas fa-search"></i>
          <input
            type="search"
            id="messageSearch"
            class="messages-search-input"
            placeholder="Search messages..."
          />
        </div>
      </div>

      <div class="messages-table-wrapper">
        <table id="messagesTable" class="messages-table">
          <thead class="messages-table-head">
            <tr>
              <th class="messages-col-name">Name</th>
              <th class="messages-col-email">Email</th>
              <th class="messages-col-message">Message</th>
              <th class="messages-col-date">Date</th>
            </tr>
          </thead>
          <tbody id="messagesBody" class="messages-table-body">
            <tr>
              <td colspan="4" class="no-data">Loading messages...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </main>

    <footer class="footer">
      <div class="footer-container">
        <!-- LEFT SIDE LINKS -->
        <div class="footer-links">
          <div class="footer-column">
            <h4>Order Online</h4>
            <ul>
              <li><a href="product-list.html#specialty">Specialty</a></li>
              <li><a href="product-list.html#coffee">Coffee</a></li>
              <li><a href="product-list.html#non-coffee">Non-Coffee</a></li>
              <li><a href="product-list.html#matcha">Matcha</a></li>
            </ul>
          </div>
          <div class="footer-column">
            <h4>Feature</h4>
            <ul>
              <li>
                <a href="index.html#customer-favorites">Customer Favorites</a>
              </li>
              <li><a href="feature.html#new-product">New Product</a></li>
              <li><a href="feature.html#featured-items">Featured Items</a></li>
            </ul>
          </div>
          <div class="footer-column">
            <h4>Support</h4>
            <ul>
              <li><a href="index.html#faq">FAQs</a></li>
              <li><a href="contact.html">Contact Us</a></li>
              <li><a href="#">Phone: 0947-191-8437</a></li>
              <li><a href="#">Mon-Sun: 10 AM - 11 PM</a></li>
            </ul>
          </div>
          <div class="footer-column">
            <h4>Get to Know Us</h4>
            <ul>
              <li><a href="index.html#about">About Us</a></li>
              <li><a href="index.html#testimonials">Testimonials</a></li>
              <li><a href="index.html#brew-guides">Brew Guides</a></li>
            </ul>
          </div>
        </div>

        <!-- NEWSLETTER -->
        <div class="footer-newsletter">
          <h4>Sign up for email updates</h4>
          <form class="newsletter-form">
            <input type="email" placeholder="Your Email" required />
            <button type="submit">Submit</button>
          </form>
          <div class="footer-socials">
            <a
              href="https://www.facebook.com/profile.php?id=61550342585463"
              target="_blank"
              ><i class="fab fa-facebook-f"></i
            ></a>
            <a href="https://www.instagram.com/agoscoffee____/" target="_blank"
              ><i class="fab fa-instagram"></i
            ></a>
            <a href="https://www.tiktok.com/@agos.coffee" target="_blanks"
              ><i class="fab fa-tiktok"></i
            ></a>
          </div>
        </div>
      </div>

      <!-- Newsletter Modal -->
      <div id="newsletterModal" class="modal">
        <div class="modal-content">
          <h3>Thank You!</h3>
          <p>You've successfully signed up for our newsletter.</p>
          <div class="modal-actions">
            <button class="btn cancel-btn" id="closeNewsletter">Close</button>
          </div>
        </div>
      </div>

      <div class="footer-bottom">
        <p>&copy; 2025 Agos Coffee. All Rights Reserved.</p>
      </div>
    </footer>

    <!-- SCRIPTS -->
    <script src="js/hamburger-menu.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="js/main.js" defer></script>
    <script src="js/newsletter-and-cart.js" defer></script>
    <script src="js/cart.js" defer></script>
    <script src="js/search.js" defer></script>
    <script src="js/events.js" defer></script>
    <script src="js/checkout.js" defer></script>

    <script>
      let allMessages = [];

      async function loadMessages(query = "") {
        try {
          if (allMessages.length === 0) {
            const res = await fetch("/api/messages");
            allMessages = await res.json();
          }

          let filtered = allMessages;
          if (query) {
            query = query.toLowerCase();
            filtered = allMessages.filter(
              (msg) =>
                msg.name.toLowerCase().includes(query) ||
                msg.email.toLowerCase().includes(query) ||
                msg.message.toLowerCase().includes(query) ||
                msg.date.includes(query)
            );
          }

          const tbody = document.getElementById("messagesBody");
          if (filtered.length === 0) {
            tbody.innerHTML =
              '<tr><td colspan="4" class="no-data">No messages found</td></tr>';
            return;
          }

          tbody.innerHTML = filtered
            .map(
              (msg) => `
    <tr class="messages-row">
      <td class="messages-col-name">
        <div class="message-info">
          <img src="${msg.image}" alt="${msg.name}" class="message-avatar"/>
          <span class="message-name-text">${msg.name}</span>
        </div>
      </td>
      <td class="messages-col-email">${msg.email}</td>
      <td class="messages-col-message" >${msg.message}</td>
      <td class="messages-col-date">${msg.date}</td>
    </tr>
  `
            )
            .join("");
        } catch (err) {
          console.error("Error loading messages:", err);
          document.getElementById("messagesBody").innerHTML =
            '<tr><td colspan="4" class="no-data">Failed to load messages</td></tr>';
        }
      }

      // Initial load
      loadMessages();

      // Search handler
      document
        .getElementById("messageSearch")
        .addEventListener("input", (e) => {
          loadMessages(e.target.value);
        });
    </script>
  </body>
</html>
